<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>オンラインゲーム ロビー</title>
  <style>
    body { font-family: sans-serif; }
    #login, #lobby { display: none; }
  </style>
</head>
<body>
  <h1>オンラインゲーム</h1>

  <div id="login">
    <input type="text" id="password" placeholder="あいことばを入力">
    <button id="enterBtn">ロビーに入る</button>
    <p id="loginMsg"></p>
  </div>

  <div id="lobby">
    <h2 id="lobbyMsg">ロビーに入りました！</h2>
    <ul id="players"></ul>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const loginDiv = document.getElementById('login');
    const lobbyDiv = document.getElementById('lobby');
    const passwordInput = document.getElementById('password');
    const enterBtn = document.getElementById('enterBtn');
    const loginMsg = document.getElementById('loginMsg');
    const lobbyMsg = document.getElementById('lobbyMsg');
    const playersList = document.getElementById('players');

    const socket = io();
    loginDiv.style.display = 'block';

    // 合言葉送信
    enterBtn.addEventListener('click', () => {
      socket.emit("join", { password: passwordInput.value });
    });

    // サーバーからの応答
    socket.on("login_result", (data) => {
      if (data.status === "waiting") {
        loginMsg.textContent = "接続中... もう一人を待っています";
      } else if (data.status === "ready") {
        loginDiv.style.display = 'none';
        lobbyDiv.style.display = 'block';
        lobbyMsg.textContent = "接続完了！ロビーに入りました！";
      } else if (data.status === "error") {
        loginMsg.textContent = "あいことばが違います！";
      }
    });

    // プレイヤー一覧更新
    socket.on("update_players", (data) => {
      playersList.innerHTML = '';
      data.players.forEach(p => {
        const li = document.createElement('li');
        li.textContent = p;
        playersList.appendChild(li);
      });
    });
  </script>
</body>
</html>
